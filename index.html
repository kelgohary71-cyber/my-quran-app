<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ© - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@700&family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #065f46; --accent: #fbbf24; --bg: #f8fafc; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: #334155; }
        .header { background: var(--primary); color: var(--accent); padding: 15px; text-align: center; border-bottom: 4px solid var(--accent); position: sticky; top: 0; z-index: 1000; }
        .container { max-width: 800px; margin: 0 auto; padding: 15px; }
        .search-card { background: var(--primary); padding: 20px; border-radius: 15px; border: 2px solid var(--accent); margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        select, input { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid var(--accent); font-family: 'Cairo'; font-weight: bold; margin-bottom: 10px; font-size: 16px; }
        .search-btn { background: var(--accent); color: var(--primary); border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 900; font-size: 18px; cursor: pointer; }
        .wird-btn { background: #10b981; color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: 900; font-size: 20px; cursor: pointer; margin-bottom: 15px; border: 2px solid var(--accent); }
        .display-area { background: white; border-radius: 15px; border: 2px solid #e2e8f0; min-height: 400px; padding: 20px; }
        .ayah-block { border-bottom: 2px dashed #f1f5f9; padding-bottom: 20px; margin-bottom: 20px; text-align: center; }
        .ayah-text { font-family: 'Scheherazade New', serif; font-size: 32px; line-height: 2.3; color: #0f172a; }
        .ayah-info { color: var(--primary); font-weight: bold; font-size: 14px; margin-top: 10px; display: block; }
        .tafseer-text { background: #f1f5f9; padding: 15px; border-radius: 8px; margin-top: 10px; font-size: 16px; text-align: right; border-right: 4px solid #3b82f6; }
        mark { background: #fbbf24; color: #000; padding: 0 2px; border-radius: 3px; }
        .nav-controls { display: flex; gap: 10px; margin-top: 15px; }
        .nav-btn { flex: 1; padding: 12px; border-radius: 8px; border: none; color: white; font-weight: 900; cursor: pointer; }
        .btn-next { background: #8b5cf6; }
        .btn-prev { background: #f97316; }
    </style>
</head>
<body>

<div class="header"><h1>Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ©</h1></div>

<div class="container">
    <button class="wird-btn" onclick="showTodayWird()">ğŸ“– Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>

    <div class="search-card">
        <select id="suraFilter"><option value="ALL">ğŸ” ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±</option></select>
        <input type="text" id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù‡Ù†Ø§ (Ù…Ø«Ø§Ù„: Ø£Ø­Ø¯)">
        <button class="search-btn" onclick="runSearch()">Ø¨Ù€Ø­Ù€Ø« ğŸ”</button>
    </div>

    <div id="resultStatus" style="text-align:center; font-weight:900; margin-bottom:10px; color:#065f46;"></div>
    
    <div class="display-area" id="mainBox">
        <div style="text-align:center; padding-top:100px; color:#94a3b8;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¢ÙŠØ©</div>
    </div>

    <div class="nav-controls" id="navBar" style="display:none;">
        <button class="nav-btn btn-prev" onclick="moveWird(-1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="nav-btn btn-next" onclick="moveWird(1)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
</div>

<script>
let dataQuran = [], dataTafseer = [], wirds = [], currentWirdIdx = 0;

// Ø¯Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
const clean = (t) => t ? t.replace(/[\u064B-\u0652]/g, "").replace(/[Ø£Ø¥Ø¢]/g, "Ø§").replace(/Ø©/g, "Ù‡").replace(/Ù‰/g, "ÙŠ").trim() : "";

async function init() {
    try {
        const [q, t] = await Promise.all([fetch('quran.json'), fetch('tafseer.json')]);
        const qJson = await q.json();
        dataTafseer = await t.json();

        const sel = document.getElementById('suraFilter');
        qJson.forEach(sura => {
            sel.options.add(new Option(sura.name, sura.name));
            sura.verses.forEach(v => {
                dataQuran.push({
                    text: v.text,
                    clean: clean(v.text),
                    sName: sura.name,
                    sId: sura.id,
                    vId: v.id
                });
            });
        });

        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£ÙˆØ±Ø§Ø¯ (20 Ø¢ÙŠØ©)
        let temp = [], lastId = 1;
        dataQuran.forEach((v, i) => {
            if(v.sId !== lastId) { if(temp.length > 0) chunk(temp); temp = []; lastId = v.sId; }
            temp.push(v);
            if(i === dataQuran.length -1) chunk(temp);
        });
    } catch(e) { alert("ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„ÙØ§Øª quran.json Ùˆ tafseer.json Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„ØµÙØ­Ø©"); }
}

function chunk(arr) { for(let i=0; i<arr.length; i+=20) wirds.push(arr.slice(i, i+20)); }

function draw(list, keyword = "") {
    const box = document.getElementById('mainBox');
    box.innerHTML = '';
    list.forEach(v => {
        let displayTxt = v.text;
        if(keyword) {
            const pattern = keyword.split('').map(char => clean(char) + "[\\u064B-\\u0652]*").join('');
            displayTxt = v.text.replace(new RegExp(`(${pattern})`, 'gi'), '<mark>$1</mark>');
        }
        const tf = dataTafseer.find(t => t.number == v.sId && t.aya == v.vId);
        box.innerHTML += `
            <div class="ayah-block">
                <div class="ayah-text">${displayTxt}</div>
                <span class="ayah-info">ï´¿${v.sName} : ${v.vId}ï´¾</span>
                <div class="tafseer-text"><b>Ø§Ù„ØªÙØ³ÙŠØ±:</b> ${tf ? tf.text : 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...'}</div>
            </div>`;
    });
    window.scrollTo(0, document.getElementById('resultStatus').offsetTop - 100);
}

function runSearch() {
    const query = clean(document.getElementById('searchInput').value);
    const sura = document.getElementById('suraFilter').value;
    if(query.length < 2) return;

    const results = dataQuran.filter(v => {
        const matchSura = (sura === "ALL") || (v.sName === sura);
        return matchSura && v.clean.includes(query);
    });

    if(results.length === 0) { alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬"); return; }

    document.getElementById('navBar').style.display = 'none';
    document.getElementById('resultStatus').innerText = `Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: ${document.getElementById('searchInput').value}`;
    draw(results, document.getElementById('searchInput').value);
}

function showTodayWird() {
    const day = Math.floor(new Date().getTime() / 86400000);
    currentWirdIdx = day % wirds.length;
    document.getElementById('navBar').style.display = 'flex';
    updateWirdView();
}

function updateWirdView() {
    const currentWird = wirds[currentWirdIdx];
    document.getElementById('resultStatus').innerText = `Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${currentWird[0].sName}`;
    draw(currentWird);
}

function moveWird(step) {
    currentWirdIdx += step;
    if(currentWirdIdx < 0) currentWirdIdx = wirds.length -1;
    if(currentWirdIdx >= wirds.length) currentWirdIdx = 0;
    updateWirdView();
}

init();
</script>
</body>
</html>
