<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@700&family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #065f46; --accent: #fbbf24; }
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; margin: 0; padding-bottom: 50px; }
        .header { background: var(--primary); color: var(--accent); padding: 15px; text-align: center; border-bottom: 4px solid var(--accent); }
        .container { max-width: 800px; margin: 20px auto; padding: 0 15px; }
        .btn-wird { background: #10b981; color: white; width: 100%; padding: 15px; border-radius: 12px; font-weight: 900; font-size: 20px; border: 2px solid var(--accent); cursor: pointer; margin-bottom: 15px; }
        .search-box { background: var(--primary); padding: 20px; border-radius: 15px; border: 2px solid var(--accent); }
        select, input { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 8px; border: 2px solid var(--accent); font-family: 'Cairo'; font-weight: bold; }
        .btn-search { background: var(--accent); color: var(--primary); width: 100%; padding: 12px; border-radius: 8px; font-weight: 900; border: none; cursor: pointer; font-size: 18px; }
        .display { background: white; border-radius: 15px; padding: 20px; margin-top: 20px; border: 1px solid #e2e8f0; min-height: 300px; }
        .ayah-item { border-bottom: 2px dashed #eee; padding: 20px 0; text-align: center; }
        .quran-text { font-family: 'Scheherazade New', serif; font-size: 32px; line-height: 2.3; margin-bottom: 10px; }
        .meta { color: var(--primary); font-weight: bold; font-size: 14px; }
        .tafseer { background: #f1f5f9; padding: 15px; border-radius: 8px; margin-top: 10px; border-right: 5px solid #3b82f6; text-align: justify; }
        mark { background: #fbbf24; color: black; font-weight: bold; padding: 0 2px; }
        .nav { display: flex; gap: 10px; margin-top: 15px; }
        .nav button { flex: 1; padding: 12px; border-radius: 8px; border: none; color: white; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

<div class="header"><h1>Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ©</h1></div>

<div class="container">
    <button class="btn-wird" onclick="loadTodayWird()">ğŸ“– Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ (20 Ø¢ÙŠØ©)</button>

    <div class="search-box">
        <select id="suraSelect" onchange="jumpSura()"><option value="ALL">ğŸ” ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±</option></select>
        <input type="text" id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù‡Ù†Ø§ Ù„Ù„Ø¨Ø­Ø«...">
        <button class="btn-search" onclick="startSearch()">Ø¨Ù€Ø­Ù€Ø«</button>
    </div>

    <div id="status" style="text-align:center; font-weight:900; margin: 15px 0; color: #065f46;"></div>
    
    <div class="display" id="content"></div>

    <div class="nav" id="navBar" style="display:none;">
        <button style="background:#f97316" onclick="changeWird(-1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button style="background:#8b5cf6" onclick="changeWird(1)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
</div>

<script>
let versesData = [], tafseerData = [], wirdsArr = [], currentWirdIdx = 0;

const cleanAr = (t) => t.replace(/[\u064B-\u0652]/g, "").replace(/[Ø£Ø¥Ø¢]/g, "Ø§").replace(/Ø©/g, "Ù‡").replace(/Ù‰/g, "ÙŠ").trim();

async function init() {
    const [q, t] = await Promise.all([fetch('quran.json'), fetch('tafseer.json')]);
    const qJson = await q.json();
    tafseerData = await t.json();

    qJson.forEach(s => {
        document.getElementById('suraSelect').options.add(new Option(s.name, s.name));
        s.verses.forEach(v => {
            versesData.push({text: v.text, clean: cleanAr(v.text), sName: s.name, sId: s.id, vId: v.id});
        });
    });

    // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£ÙˆØ±Ø§Ø¯ (20 Ø¢ÙŠØ© Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø³ÙˆØ±)
    let temp = [], lastSId = 1;
    versesData.forEach((v, i) => {
        if(v.sId !== lastSId) { chunk(temp); temp = []; lastSId = v.sId; }
        temp.push(v);
        if(i === versesData.length -1) chunk(temp);
    });
}

function chunk(a) { for(let i=0; i<a.length; i+=20) wirdsArr.push(a.slice(i, i+20)); }

function renderUI(list, key = "") {
    const box = document.getElementById('content');
    box.innerHTML = '';
    list.forEach(v => {
        let txt = v.text;
        if(key) {
            const pattern = key.split('').map(c => cleanAr(c) + "[\\u064B-\\u0652]*").join('');
            txt = txt.replace(new RegExp(`(${pattern})`, 'gi'), '<mark>$1</mark>');
        }
        const tf = tafseerData.find(t => t.number == v.sId && t.aya == v.vId);
        box.innerHTML += `<div class="ayah-item">
            <div class="quran-text">${txt}</div>
            <div class="meta">ï´¿${v.sName} : ${v.vId}ï´¾</div>
            <div class="tafseer"><b>Ø§Ù„ØªÙØ³ÙŠØ±:</b> ${tf ? tf.text : '...'}</div>
        </div>`;
    });
}

function startSearch() {
    const q = cleanAr(document.getElementById('searchInput').value);
    const s = document.getElementById('suraSelect').value;
    if(q.length < 2) return;
    const res = versesData.filter(v => (s === "ALL" || v.sName === s) && v.clean.includes(q));
    if(res.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬");
    document.getElementById('navBar').style.display = 'none';
    document.getElementById('status').innerText = `Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù†: ${document.getElementById('searchInput').value}`;
    renderUI(res, document.getElementById('searchInput').value);
}

function jumpSura() {
    const s = document.getElementById('suraSelect').value;
    if(s === "ALL") return;
    currentWirdIdx = wirdsArr.findIndex(w => w[0].sName === s);
    loadWirdByIndex();
}

function loadTodayWird() {
    currentWirdIdx = Math.floor(new Date().getTime() / 86400000) % wirdsArr.length;
    loadWirdByIndex();
}

function loadWirdByIndex() {
    document.getElementById('navBar').style.display = 'flex';
    document.getElementById('status').innerText = `Ø§Ù„ÙˆØ±Ø¯: ${wirdsArr[currentWirdIdx][0].sName}`;
    renderUI(wirdsArr[currentWirdIdx]);
}

function changeWird(n) {
    currentIdx = (currentWirdIdx + n + wirdsArr.length) % wirdsArr.length;
    currentWirdIdx = currentIdx;
    loadWirdByIndex();
}

init();
</script>
</body>
</html>
