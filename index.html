<script>
    // Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    document.addEventListener('contextmenu', e => e.preventDefault());
    
    let allVerses = [];
    let tafseerData = [];
    let currentPage = 0;
    const pageSize = 10;
    let currentDisplayedVerses = [];
    let dataLoaded = false;

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙˆØ±Ù‹Ø§ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    async function init() {
        try {
            const qRes = await fetch('quran.json');
            const suras = await qRes.json();
            const select = document.getElementById('suraSelect');
            
            suras.forEach(sura => {
                let opt = document.createElement('option');
                opt.value = sura.name; 
                opt.textContent = sura.name;
                select.appendChild(opt);
                sura.verses.forEach(v => {
                    allVerses.push({ text: v.text, sNum: sura.id, sName: sura.name, vNum: v.id });
                });
            });

            const tRes = await fetch('tafseer.json');
            tafseerData = await tRes.json();
            dataLoaded = true;
            console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
        } catch (e) { 
            console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª (ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ quran.json Ùˆ tafseer.json):", e);
        }
    }

    function showWird() {
        if (!dataLoaded) {
            alert("â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø©...");
            return;
        }
        document.getElementById('controlsBox').classList.add('active');
        document.getElementById('contentArea').classList.add('active');
        render();
    }

    function render(data = null) {
        const list = data || allVerses;
        const start = currentPage * pageSize;
        currentDisplayedVerses = list.slice(start, start + pageSize);
        
        let qH = ""; let tH = "";
        currentDisplayedVerses.forEach(v => {
            qH += `<div style="margin-bottom:35px;">${v.text} <span class="verse-info">ï´¿${v.sName}: ${v.vNum}ï´¾</span></div>`;
            const t = tafseerData.find(x => parseInt(x.number) === v.sNum && parseInt(x.aya) === v.vNum);
            v.tafseer = t ? t.text : "Ø§Ù„ØªÙØ³ÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©";
            tH += `<p style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;"><strong>${v.sName} (${v.vNum}):</strong><br>${v.tafseer}</p>`;
        });
        document.getElementById('quran-content').innerHTML = qH;
        document.getElementById('tafseer-content').innerHTML = tH;
        document.getElementById('q-box-scroll').scrollTop = 0;
    }

    function changePage(d) { 
        if((currentPage+d)*pageSize >= 0 && (currentPage+d)*pageSize < allVerses.length){ 
            currentPage+=d; 
            render(); 
        } 
    }

    function jumpToSura() { 
        const n = document.getElementById('suraSelect').value; 
        if(n){ 
            currentPage = Math.floor(allVerses.findIndex(v=>v.sName===n)/pageSize); 
            render(); 
        } 
    }

    function searchQuran() { 
        const t = document.getElementById('searchInput').value; 
        if(t.length>2){ 
            render(allVerses.filter(v=>v.text.includes(t))); 
        } else if(!t){ 
            render(); 
        } 
    }
    
    function shareCurrentWird() {
        let message = "ğŸ“– ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ… Ù…Ù† ØªØ·Ø¨ÙŠÙ‚ (Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ©):\n\n";
        currentDisplayedVerses.forEach(v => {
            message += `ğŸ”¹ ${v.text} (${v.sName}: ${v.vNum})\nğŸ”¸ Ø§Ù„ØªÙØ³ÙŠØ±: ${v.tafseer}\n\n`;
        });
        message += "âœ¨ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ù„Ù„Ø£Ø³ØªØ§Ø° Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ\n";
        message += "ğŸ”— " + window.location.href;

        showShareOptions(message);
    }

    function showShareOptions(message) {
        const shareUrl = window.location.href;
        const encodedMessage = encodeURIComponent(message);
        const encodedUrl = encodeURIComponent(shareUrl);
        
        const options = `
            <div id="shareOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; display: flex; align-items: center; justify-content: center; font-family: 'Cairo';" onclick="this.remove()">
                <div style="background: white; padding: 25px; border-radius: 20px; max-width: 90%; width: 400px;" onclick="event.stopPropagation()">
                    <h3 style="text-align: center; color: #065f46; margin-bottom: 20px;">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</h3>
                    <a href="https://wa.me/?text=${encodedMessage}" target="_blank" style="display: block; background: #25D366; color: white; padding: 12px; margin: 8px 0; border-radius: 10px; text-decoration: none; text-align: center; font-weight: bold;">ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨</a>
                    <a href="https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}" target="_blank" style="display: block; background: #1877F2; color: white; padding: 12px; margin: 8px 0; border-radius: 10px; text-decoration: none; text-align: center; font-weight: bold;">ğŸ‘¥ ÙÙŠØ³Ø¨ÙˆÙƒ</a>
                    <a href="https://t.me/share/url?url=${encodedUrl}&text=${encodedMessage}" target="_blank" style="display: block; background: #0088cc; color: white; padding: 12px; margin: 8px 0; border-radius: 10px; text-decoration: none; text-align: center; font-weight: bold;">âœˆï¸ ØªÙ„ÙŠØ¬Ø±Ø§Ù…</a>
                    <button onclick="copyTextToClipboard(\`${message.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`)" style="display: block; width: 100%; background: #047857; color: white; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; font-size: 18px; font-weight: bold; cursor: pointer;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ù†Øµ</button>
                    <button onclick="document.getElementById('shareOverlay').remove()" style="display: block; width: 100%; background: #dc2626; color: white; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; font-weight: bold; cursor: pointer;">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        `;
        document.body.insertAdjacentHTML('beforeend', options);
    }

    function copyTextToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById('shareOverlay').remove();
        }).catch(() => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¨Ù†Ø¬Ø§Ø­!");
            document.getElementById('shareOverlay').remove();
        });
    }
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    init();

    // Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù€ Console
    console.log('%câš ï¸ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ© - Ø§Ù„Ø£Ø³ØªØ§Ø° Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ', 'color: green; font-size: 16px; font-weight: bold;');
</script>