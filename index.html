<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@700&family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #065f46; --accent: #fbbf24; --bg: #f0fdf4; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: #1f2937; line-height: 1.6; }
        .header { background: var(--primary); color: var(--accent); padding: 20px; text-align: center; border-bottom: 5px solid var(--accent); sticky; top: 0; z-index: 1000; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .container { max-width: 900px; margin: 0 auto; padding: 15px; }
        .card { background: white; border-radius: 15px; padding: 20px; border: 3px solid var(--primary); margin-bottom: 20px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .btn-main { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 15px; border-radius: 12px; font-weight: 900; width: 100%; font-size: 20px; border: 3px solid var(--accent); cursor: pointer; margin-bottom: 15px; transition: 0.3s; }
        .btn-main:active { transform: scale(0.98); }
        .search-area { background: var(--primary); padding: 20px; border-radius: 15px; border: 3px solid var(--accent); }
        select, input { width: 100%; padding: 14px; border-radius: 10px; border: 2px solid var(--accent); font-family: 'Cairo'; font-weight: 700; font-size: 16px; margin-bottom: 12px; outline: none; }
        .search-row { display: flex; gap: 10px; }
        .btn-search { background: var(--accent); color: var(--primary); border: none; padding: 0 25px; border-radius: 10px; cursor: pointer; font-weight: 900; font-size: 18px; }
        .result-title { background: var(--accent); color: var(--primary); padding: 10px; border-radius: 8px; text-align: center; font-weight: 900; margin: 15px 0; }
        .display-box { height: 500px; overflow-y: auto; padding: 15px; background: #fff; border: 3px solid #ddd; border-radius: 10px; scroll-behavior: smooth; }
        .ayah-card { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px dashed #eee; text-align: center; }
        .ayah-text { font-family: 'Scheherazade New', serif; font-size: 32px; line-height: 2.2; color: #111827; }
        .ayah-meta { color: var(--primary); font-weight: 900; font-size: 16px; margin-top: 10px; display: block; }
        .tafseer-box { background: #eff6ff; border-right: 5px solid #3b82f6; padding: 15px; margin-top: 10px; font-size: 18px; text-align: justify; border-radius: 5px; }
        mark { background: #fbbf24; color: black; padding: 0 2px; border-radius: 3px; font-weight: bold; }
        .nav-btns { display: flex; gap: 15px; margin-top: 20px; }
        .nav-btn { flex: 1; padding: 15px; border: none; border-radius: 12px; font-size: 18px; font-weight: 900; color: white; cursor: pointer; }
        .btn-prev { background: #f97316; }
        .btn-next { background: #8b5cf6; }
        .footer { text-align: center; padding: 20px; font-weight: 900; color: var(--primary); }
    </style>
</head>
<body>

<div class="header"><h1>Ø¨Ù„ØºÙˆØ§ Ø¹Ù†ÙŠ ÙˆÙ„Ùˆ Ø¢ÙŠØ©</h1></div>

<div class="container">
    <button class="btn-main" onclick="loadWird()">ğŸ“– Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ (20 Ø¢ÙŠØ©)</button>

    <div class="search-area">
        <select id="suraSelector" onchange="jumpToSura()">
            <option value="">-- Ø§Ø¨Ø­Ø« ÙÙŠ ÙƒÙ„ Ø§Ù„Ø³ÙˆØ± --</option>
        </select>
        <div class="search-row">
            <input type="text" id="searchInp" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø© Ù‡Ù†Ø§ (Ø¨Ø¯ÙˆÙ† ØªØ´ÙƒÙŠÙ„)...">
            <button class="btn-search" onclick="executeSearch()">Ø¨Ø­Ø«</button>
        </div>
    </div>

    <div id="contentSection" style="display:none;">
        <div id="statusLabel" class="result-title"></div>
        <div class="display-box" id="mainDisplay"></div>
        <div class="nav-btns" id="navGroup">
            <button class="nav-btn btn-prev" onclick="changeWird(-1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button class="nav-btn btn-next" onclick="changeWird(1)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
    </div>

    <div class="footer">ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ°: Ø£ / Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ</div>
</div>

<script>
let allVerses = [], allTafseer = [], wirdsList = [], currentIdx = 0;

// ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù„Ù„Ø¨Ø­Ø«
function normalize(txt) {
    if(!txt) return "";
    return txt.replace(/[\u064B-\u0652]/g, "").replace(/[Ø£Ø¥Ø¢]/g, "Ø§").replace(/Ø©/g, "Ù‡").replace(/Ù‰/g, "ÙŠ");
}

async function startApp() {
    try {
        const [qRes, tRes] = await Promise.all([fetch('quran.json'), fetch('tafseer.json')]);
        const qData = await qRes.json();
        allTafseer = await tRes.json();

        const sel = document.getElementById('suraSelector');
        qData.forEach(s => {
            let opt = new Array(1); 
            sel.options.add(new Option(s.name, s.name));
            s.verses.forEach(v => {
                allVerses.push({
                    text: v.text,
                    clean: normalize(v.text),
                    sName: s.name,
                    sId: s.id,
                    vId: v.id
                });
            });
        });

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ÙˆØ±Ø§Ø¯ (20 Ø¢ÙŠØ© + Ø¨Ø¯Ø§ÙŠØ© Ø³ÙˆØ±Ø©)
        let temp = [], lastSura = 1;
        allVerses.forEach((v, i) => {
            if(v.sId !== lastSura) {
                if(temp.length > 0) splitToWirds(temp);
                temp = []; lastSura = v.sId;
            }
            temp.push(v);
            if(i === allVerses.length - 1) splitToWirds(temp);
        });
        console.log("App Ready");
    } catch(e) { alert("Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„ÙØ§Øª JSON"); }
}

function splitToWirds(arr) {
    for(let i=0; i<arr.length; i+=20) wirdsList.push(arr.slice(i, i+20));
}

function render(data, highlight = "") {
    const box = document.getElementById('mainDisplay');
    document.getElementById('contentSection').style.display = 'block';
    box.innerHTML = '';
    
    data.forEach(v => {
        let txt = v.text;
        if(highlight) {
            const pattern = highlight.split('').map(c => normalize(c) + "[\\u064B-\\u0652]*").join('');
            txt = txt.replace(new RegExp(`(${pattern})`, 'gi'), '<mark>$1</mark>');
        }
        
        const tf = allTafseer.find(t => t.number == v.sId && t.aya == v.vId);
        box.innerHTML += `
            <div class="ayah-card">
                <div class="ayah-text">${txt}</div>
                <span class="ayah-meta">ï´¿${v.sName}: ${v.vId}ï´¾</span>
                <div class="tafseer-box"><b>Ø§Ù„ØªÙØ³ÙŠØ±:</b> ${tf ? tf.text : 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
            </div>`;
    });
    box.scrollTop = 0;
}

function loadWird() {
    const day = Math.floor(new Date().getTime() / 86400000);
    currentIdx = day % wirdsList.length;
    document.getElementById('navGroup').style.display = 'flex';
    document.getElementById('statusLabel').innerText = `Ø§Ù„ÙˆØ±Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ: ${wirdsList[currentIdx][0].sName}`;
    render(wirdsList[currentIdx]);
}

function jumpToSura() {
    const sName = document.getElementById('suraSelector').value;
    if(!sName) return;
    currentIdx = wirdsList.findIndex(w => w[0].sName === sName);
    document.getElementById('navGroup').style.display = 'flex';
    document.getElementById('statusLabel').innerText = `Ø³ÙˆØ±Ø© ${sName}`;
    render(wirdsList[currentIdx]);
}

function executeSearch() {
    const query = document.getElementById('searchInp').value.trim();
    const targetSura = document.getElementById('suraSelector').value;
    if(query.length < 2) return alert("Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© ØµØ­ÙŠØ­Ø©");

    const cleanQ = normalize(query);
    let results = allVerses.filter(v => {
        const inSura = targetSura ? v.sName === targetSura : true;
        return inSura && v.clean.includes(cleanQ);
    });

    if(results.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ÙÙŠ " + (targetSura || "Ø§Ù„Ù…ØµØ­Ù"));

    document.getElementById('navGroup').style.display = 'none';
    document.getElementById('statusLabel').innerText = `Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "${query}" : ${results.length} Ø¢ÙŠØ©`;
    render(results, query);
}

function changeWird(dir) {
    currentIdx += dir;
    if(currentIdx < 0) currentIdx = wirdsList.length - 1;
    if(currentIdx >= wirdsList.length) currentIdx = 0;
    document.getElementById('statusLabel').innerText = `Ø§Ù„ÙˆØ±Ø¯: ${wirdsList[currentIdx][0].sName}`;
    render(wirdsList[currentIdx]);
}

startApp();
</script>
</body>
</html>
